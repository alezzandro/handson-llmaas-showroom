:imagesdir: ../assets/images

[#api-gateway]
= AI at Scale with an API Gateway

Now, in this next step, you’re still acting as a platform engineer - but your focus now shifts from deploying a model to making it safely consumable across your organization.

Exposing foundation models directly is risky without controls. You’ll now add a governance layer using an API gateway, so other teams can use the model securely, reliably, and at scale—without direct access to the underlying cluster or GPUs.

We'll use 3scale API Management to:

* Secure access to your model
* Monitor usage
* Enable future scaling and quotas.

In production, you may also use any preferred API Gateway provider substituted into this experience.

== Step 1: Accessing the 3Scale Admin Portal

Let's log into the 3scale Admin UI and manage access to the `granite-3dot2-8b-instruct` model.

**Get your 3scale credentials**
The `admin-user` and `admin-password` values can be found in the `system-seed` secret in the `3scale` namespace.

From a Terminal (in your OpenShift console) you will run a single command to retrieve these values. 

You may also retrieve them by navigating to the location of the secret in the OpenShift console.

1. Navigate to the OpenShift console

https://console-openshift-console.{openshift_cluster_ingress_domain}/[https://console-openshift-console.{openshift_cluster_ingress_domain}/,window=_blank]

2. Select the terminal icon in the top navigation bar

image::02/open-terminal.png[width="50%"]

3. Copy the following command into the terminal session:
+
[source,bash,role="execute",subs="+macros,+attributes"]
----
oc get secret system-seed -n 3scale -o template='{{range $key, $value := .data}}{{if or (eq $key "ADMIN_USER") (eq $key "ADMIN_PASSWORD")}}{{printf "%s: " $key}}{{ $value | base64decode }}{{"\n"}}{{end}}{{end}}'
----

**Log into the admin portal**

Go to: https://maas-admin.{openshift_cluster_ingress_domain}/[https://maas-admin.{openshift_cluster_ingress_domain}/,window=_blank] 

Use the credentials you just retrieved.

You will be prompted by a wizard window. Close it by clicking on the top right corner of the screen.

[.bordershadow]
image::03/03-3scale-close-wizard.png[width="50%"]

== Step 2: Explore the 3Scale Admin Portal

Now you are in the control plane for the API services!

Here is where platform engineers:

* Create API products
* Define backend services
* Control rate limits and access policies
* Monitor traffic and user activity

+
[.bordershadow]
image::03/03-3scale-admin-dashboard.png[width="50%"]

Use the dropdown menu at the top to explore these sections:

* **Audience**: this gives you information about the users, registrations, etc.
* **Products**: this is where you can create the Products that people will have access to. You can see there are two products already created: `granite-3dot2-8b-instruct`, which is connected to the model that was pre-deployed,  and `API`, which is a default 3Scale echo API for testing.
* **Backends**: this is where you can see the backends that can be used by your products. You can see that the `granite-3dot2-8b-instruct` backend that is used by the the `granite-3dot2-8b-instruct` product.


[.bordershadow]
image::03/03-3scale-section-menu.png[width="50%"]

For now, note the two key items:

* A product named `granite-3dot2-8b-instruct` (mapped to your model)
* A backend service with the same name powering that product

[#3scale-dev-portal]
== Step 3: Configure Developer Portal Access
//TODO: clean up below
Developers access the models via the Developer Portal - your user-friendly frontend for API onboarding.

A user was already created for you in 3Scale in (Audience->Accounts->Listing), but you still need to configure the developer portal to allow users to access it. In this configuration, our user is automatically subscribed to the `granite-3dot2-8b-instruct` service. In a production environment, you would normally automate this process as part of the deployment of a new product. 

* In the Audience section, got to Developer Portal->Settings->Domains & Access.
+
[.bordershadow]
image::03/03-3scale-portal-menu.png[width="50%"]

* The Developer Portal Access Code is used to control the access the developer portal. You could use the default value in the next section to connect to it, but for today simply delete it and click on `Update Account`. This will remove the access code and allow anyone to access the developer portal, although they will still need to authenticate. This is what we will do in this workshop.
+
[.bordershadow]
image::03/03-3scale-remove-access-code.png[width="50%"]


== Step 4: Log in to the Developer Portal

// Add role shifting phrasing

Visit the portal at: https://maas.{openshift_cluster_ingress_domain}[https://maas.{openshift_cluster_ingress_domain},window=_blank].

You can log in using your workshop credentials:

* Your username: `{user}`
* Your password: `{password}`

Signing in:

1. Click on the `Sign In` button in the top right corner of the screen
+
[.bordershadow]
image::03/03-3scale-signin-button.png[width="50%"]

2.  Click on `Private login` and enter your credentials.
+
[.bordershadow]
image::03/03-3scale-signin.png[width="50%"]

Once logged in, you will be able to see available APIs, including the model you deployed.

[.bordershadow]
image::03/03-3scale-developer-loggedin.png[width="50%"]

== Step 5: Create an Application and Get an API Key

As a developer, you will need to register an application to get credentials for API access. 

Let's do that now:

1. Click on the `See your Applications and their credentials` link on the front page.
+
[.bordershadow]
image::03/03-3scale-see-applications.png[width="50%"]

2. You will be taken to the `Apps and API Keys` section, where you can see that there is an application that was already created for you (the 3Scale default Echo API). Start creating a new application by clicking on the `Create new application` button.
+
[.bordershadow]
image::03/03-3scale-create-application.png[width="50%"]

3. Select the Service you want to use. In this case, we will use the `granite-3dot2-8b-instruct` service that has been pre-deployed.
+
[.bordershadow]
image::03/03-3scale-select-service.png[width="50%"]

4. Give a name to your application, for example `Granite application`. Click on `Create Application`.
+
[.bordershadow]
image::03/03-3scale-application-name.png[width="50%"]

5. Your application has been created. You can see the Endpoint URL you can use to connect to the API, the name of the model you must use in your requests, and the API key that has been generated for you.

+
[.bordershadow]
image::03/03-3scale-key-generated.png[width="50%"]

**Copy and save this information** - you will use it in the next module to make real requests to your model.

== Recap: What you just did

You've continued walking in the shoes of our platform engineer and:

* Logged into a production-grade API gateway
* Located your deployed model as a 3scale product
* Enabled access via the developer portal
* Shifted to a developer's perspective and created a client application to securely retrieve an API key.

That API key gives your model its first real consumer. A crucial step in turning infrastructure into a "service". 
